# ДИПЛОМНА РОБОТА  

## Опис дипломної роботи  

Метою цієї дипломної роботи є автоматизація процесу розгортання інфраструктури для моніторингу та розгортання вебсайту. Робота передбачає кілька етапів, включаючи розгортання інстансу на AWS, встановлення інструменту моніторингу Uptime Kuma для спостереження за станом сайту, а також створення та налаштування віртуальної машин (ВМ) в середовищі Proxmox VE (PVE), на якій буде встановлено Jenkins для автоматичного розгортання вебсайту через Docker Compose.  

## Основні етапи реалізації:  

### 1. Розгортання на AWS:  
- Створення інстансу на AWS для хостингу моніторингової платформи.  
- Використання Terraform (`main.tf`, `variables.tf`) для автоматизації створення інфраструктури.  
- Встановлення Uptime Kuma (`uptime_kuma.sh`) для моніторингу доступності сайту.  

### 2. Розгортання на PVE:  
- Створення шаблону (`ubuntu_template.sh`) віртуальної машини (VM) в PVE для подальшого використання.
- Використання Terraform (`main.tf`, `variables.tf`) для автоматизації створення та конфігурації віртуальної машини.  
- Встановлення Jenkins (`install_jenkins.sh`) для оркестрації CI/CD проектів.  

### 3. Jenkins та CI/CD pipeline:  
- Використання Jenkins для автоматизації процесу розгортання вебсайту через Docker Compose.  
- Створення та налаштування Jenkins pipeline для автоматичного розгортання та оновлення сайту, використовуючи Docker Compose.  

### 4. Управління проектом:  
- **`start.sh`**: запускає проект, ініціюючи необхідні компоненти системи для моніторингу та CI/CD процесу.  
- **`stop.sh`**: зупиняє та видаляє проект, забезпечуючи очищення та відключення всіх активних компонентів системи.  

Проект забезпечує повний цикл управління інфраструктурою для моніторингу та автоматичного розгортання вебсайту з можливістю його моніторингу та швидкого запуску/зупинки всіх компонентів системи.  

## Перевірка прав у Bash-скриптах та надійна обробка помилок:  

### 1. Призначення:  
Bash-скрипти за замовчуванням обмежують виконання за відсутності необхідних прав та не завжди виявляють помилки. Щоб забезпечити надійність і безпеку, використовується комбінація перевірки прав суперкористувача та обробки помилок:  

```bash
#!/usr/bin/env bash  
set -euo pipefail  

# Перевірка прав суперкористувача  
if [ "$(id -u)" -ne 0 ]; then  
  echo -e "\nПомилка: Скрипт потребує прав суперкористувача (root).\n" >&2  
  exit 1  
fi  

# Обробка помилок  
trap 'echo -e "\nПомилка на рядку $LINENO: $BASH_COMMAND\n" >&2; exit 1' ERR  
```

Цей шаблон поєднує перевірку прав суперкористувача (root) та механізм обробки помилок для Bash-скриптів. Його мета — забезпечити стабільне, безпечне та передбачуване виконання скриптів, що потребують підвищених привілеїв, із чіткою діагностикою помилок та уніфікованим підходом до керування виконанням.  

### 2. Пояснення:  
- **```#!/usr/bin/env bash```**  
  Забезпечує портативність, дозволяючи використовувати Bash незалежно від його розташування в системі.  

- **```set -euo pipefail```**  
  - `-e`: Негайно завершує виконання скрипта при виникненні помилки.  
  - `-u`: Викликає помилку при використанні неоголошених змінних.  
  - `-o pipefail`: Гарантує, що помилка в будь-якій частині конвеєра призведе до завершення виконання.  

- **```if [ "$(id -u)" -ne 0 ]; then ...```**  
  Перевіряє, чи користувач має права суперкористувача (UID = 0). Якщо ні, виводить повідомлення про помилку на stderr (`>&2`) та завершує скрипт із кодом помилки 1.  

- **```trap 'echo -e "\nПомилка на рядку $LINENO: $BASH_COMMAND\n" >&2; exit 1' ERR```**  
  Перехоплює помилки, виводить детальну інформацію (номер рядка та команда, що викликала помилку) на stderr і завершує скрипт.  

### 3. Приклад використання:  
```bash
#!/usr/bin/env bash  
set -euo pipefail  

# Перевірка прав суперкористувача  
if [ "$(id -u)" -ne 0 ]; then  
  echo -e "\nПомилка: Скрипт потребує прав суперкористувача (root).\n" >&2  
  exit 1  
fi  

# Обробка помилок  
trap 'echo -e "\nПомилка на рядку $LINENO: $BASH_COMMAND\n" >&2; exit 1' ERR  

# Операції, що потребують прав root  
mkdir -p /root/test_dir  
cp /неіснуючий_файл.txt /root/test_dir/  
```

→ **Вивід при виконанні без прав root**:  
```
Помилка: Скрипт потребує прав суперкористувача (root).
```

→ **Вивід при помилці з правами root**:  
```
Помилка на рядку 15: cp /неіснуючий_файл.txt /root/test_dir/
```

### 4. Переваги:  
- **Уніфікований підхід**: Забезпечує однакову поведінку всіх скриптів у проєкті.  
- **Безпека**: Перевірка прав запобігає виконанню операцій без необхідних привілеїв.  
- **Чітка діагностика**: Детальні повідомлення про помилки з номером рядка та командою.  
- **Надійність**: Захист від необ’явлених змінних і помилок у конвеєрах.  
- **Відповідність стандартам**: Дотримання найкращих практик розробки Bash-скриптів.  

### 5. Рекомендації:  
- Додавайте цей шаблон до всіх Bash-скриптів, які потребують прав суперкористувача, для забезпечення безпеки та надійності.  
- Використовуйте перенаправлення на stderr (`>&2`) для повідомлень про помилки, щоб відповідати стандартам Unix.  
- Для додаткової функціональності (наприклад, логування) цей шаблон можна комбінувати з іншими механізмами.
